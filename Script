// main.js — Optimizado para Nonoalko 💥 versión mejorada

document.addEventListener('DOMContentLoaded', () => {
  const body = document.body;

  // 🌗 Alternador de tema con preferencia guardada (más robusto)
  const btnTema = document.querySelector('#modo-tema');
  let temaGuardado;
  try {
    temaGuardado = localStorage.getItem('tema');
  } catch (e) {
    temaGuardado = null; // Fallback si falla el acceso
  }

  const usaModoOscuro = temaGuardado === 'oscuro' || 
    (!temaGuardado && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);

  if (usaModoOscuro) {
    body.classList.add('modo-oscuro');
  }

  if (btnTema) {
    btnTema.addEventListener('click', () => {
      const activado = body.classList.toggle('modo-oscuro');
      try {
        localStorage.setItem('tema', activado ? 'oscuro' : 'claro');
      } catch (e) {
        console.warn('No se pudo guardar la preferencia de tema.', e);
      }
    });
  }

  // 🔗 Scroll suave entre secciones (con verificación de destino)
  const enlacesInternos = document.querySelectorAll('a[href^="#"]');
  enlacesInternos.forEach(enlace => {
    enlace.addEventListener('click', e => {
      const destinoID = enlace.getAttribute('href');
      if (destinoID.length > 1) {
        const destino = document.querySelector(destinoID);
        if (destino) {
          e.preventDefault();
          destino.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });
  });

  // 🖼 Galería responsiva con columnas variables
  function ajustarGaleria() {
    const galeria = document.querySelector('.gallery');
    if (galeria) {
      let columnas = 3;
      if (window.innerWidth < 600) columnas = 1;
      else if (window.innerWidth < 900) columnas = 2;
      galeria.style.display = 'grid';
      galeria.style.gridTemplateColumns = `repeat(${columnas}, 1fr)`;
      galeria.style.gap = '1rem'; // Puedes personalizar el espacio
    }
  }

  window.addEventListener('resize', ajustarGaleria);
  ajustarGaleria();

  // 👀 Animaciones al hacer scroll
  const elementosAnimables = document.querySelectorAll('section, .gallery img, form, .card, .proyecto');
  const observer = new IntersectionObserver(entradas => {
    entradas.forEach(entrada => {
      if (entrada.isIntersecting) {
        entrada.target.classList.add('visible');
        observer.unobserve(entrada.target); // Mejor rendimiento: dejar de observar
      }
    });
  }, { threshold: 0.15 });

  elementosAnimables.forEach(el => observer.observe(el));

  // ✉️ Confirmación al enviar formulario (más accesible)
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', () => {
      setTimeout(() => {
        alert('🎨 ¡Gracias por tu encargo! Te contactaré pronto.');
      }, 500);
    });
  }
});
